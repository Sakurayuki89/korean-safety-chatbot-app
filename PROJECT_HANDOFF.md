# 🚀 PROJECT HANDOFF: 한국어 안전 상담 챗봇

## 📋 프로젝트 현황 요약

### 현재 완성도: **25% → 목표: 85%**
- **기간**: 2-3주 집중 개발
- **접근법**: Google Drive + PDF 뷰어 하이브리드 시스템
- **최종 목표**: 문서 기반 지능형 안전 상담 챗봇

---

## ✅ 완료된 핵심 기능 (25%)

### 1. 채팅 시스템 완성 ✅
- **Gemini AI 1.5 Pro** 통합 (스트리밍 응답)
- **한국어 안전 상담 페르소나** 적용
- **실시간 채팅 UI** with 자동 스크롤
- **MongoDB 대화 기록** 저장/조회

### 2. 인프라 및 개발 도구 ✅
- **Next.js 15** + **React 19** + **TypeScript**
- **MongoDB Atlas** 연동
- **환경변수 설정** 완료 (.env.local)
- **좀비 프로세스 방지** 스크립트
- **트러블슈팅 가이드** (TROUBLESHOOTING.md)
- **GitHub 저장소** 관리

### 3. 현재 프로젝트 구조
```
korean-safety-chatbot-app/
├── app/
│   ├── api/chat/route.ts          # Gemini API + 스트리밍
│   ├── api/history/route.ts       # 대화 기록 조회
│   ├── api/db-status/route.ts     # DB 상태 확인
│   └── page.tsx                   # 메인 페이지
├── components/
│   ├── ChatContainer.tsx          # 채팅 컨테이너 (메인)
│   ├── MessageList.tsx            # 메시지 목록 + 스크롤
│   ├── MessageInput.tsx           # 메시지 입력
│   ├── ChatWidget.tsx             # 채팅 위젯
│   └── NoticeBoard.tsx            # 공지사항
├── lib/
│   ├── gemini.ts                  # Gemini AI 설정
│   ├── mongodb.ts                 # MongoDB 연결
│   └── prompts.ts                 # AI 프롬프트
└── [설정 파일들]
```

---

## 🎯 새로운 방향: 하이브리드 시스템

### 핵심 아이디어
**"Google Drive PDF 뷰어 + 기존 Gemini 채팅봇 연동"**

### 전략적 이유
1. **비용 효율성**: 임베딩 API 불필요 ($0 vs $100-300/월)
2. **개발 속도**: 복잡한 벡터 DB 없이 2-3주 완성
3. **사용자 경험**: 직관적 - 문서 보며 실시간 질문
4. **확장성**: Word, Excel, PPT 등 다양한 형식 지원 가능

### 기술적 장점
- 사용자 개인 Google Drive 활용 (보안 + 무료 저장소)
- 실시간 문서 컨텍스트 제공
- 텍스트 선택 → 자동 질문 생성
- 페이지별 질문 가능

---

## 🏗️ 목표 아키텍처

### UI 레이아웃
```
┌─────────────────────────────────────────────────┐
│  🛡️ 한국어 안전 상담 챗봇                        │
├─────────────────────┬───────────────────────────┤
│  📄 PDF 뷰어        │  💬 채팅 영역               │
│                     │                           │
│  [Google Drive 목록] │  💬 실시간 스트리밍 채팅     │
│  📋 화재안전.pdf    │  🎯 현재 문서 컨텍스트       │
│  📋 교통안전.pdf    │  📄 페이지별 질문 가능       │
│  📋 응급처치.pdf    │  ✏️ 텍스트 선택 → 자동 질문  │
│                     │                           │
│  [선택된 PDF 표시]   │  [기존 채팅 시스템 유지]     │
│  📖 페이지 3/15     │                           │
└─────────────────────┴───────────────────────────┘
```

### 데이터 플로우
```
1. Google OAuth → Drive API 인증
2. Drive 파일 목록 → PDF 선택
3. PDF 뷰어 로드 → 현재 페이지 추적
4. 채팅 질문 → "현재 문서: X, 페이지: Y" 컨텍스트 추가
5. Gemini AI → 컨텍스트 기반 답변 생성
6. 텍스트 선택 → 선택 내용 기반 질문 생성
```

---

## 🔧 필요한 기술 스택 추가

### 새로 추가할 라이브러리
```json
{
  "dependencies": {
    "googleapis": "^134.0.0",           // Google Drive API
    "react-pdf": "^7.7.0",             // PDF 뷰어
    "pdfjs-dist": "^4.0.0",            // PDF.js 백엔드
    "react-dropzone": "^14.2.3",       // 드래그앤드롭
    "react-split-pane": "^2.0.3"       // 화면 분할
  }
}
```

### Google Cloud 설정 필요
- Google Cloud Console 프로젝트 생성
- Drive API 활성화
- OAuth 2.0 클라이언트 ID 생성
- 승인된 리디렉션 URI 설정

---

## ⚠️ 중요 제약사항 및 고려사항

### 성능 고려사항
- **PDF 파일 크기**: 50MB 이하 권장
- **동시 사용자**: Drive API 할당량 관리 필요
- **응답 시간**: PDF 로딩 3초 이내, 채팅 응답 5초 이내

### 보안 고려사항
- **OAuth 토큰 관리**: 안전한 저장 및 갱신
- **사용자 권한**: Drive 파일 접근 권한 최소화
- **데이터 보호**: 사용자 파일 서버 저장 금지

### 기술적 제약사항
- **한국어 PDF**: 인코딩 문제 대응 필요
- **모바일 대응**: 터치 스크롤 최적화
- **브라우저 호환성**: PDF.js Safari 성능 이슈

---

## 📊 성공 지표

### 기능적 목표
- ✅ Google Drive 연동 완료
- ✅ PDF 뷰어 정상 작동
- ✅ 채팅-문서 컨텍스트 연동
- ✅ 텍스트 선택 기반 질문 생성
- ✅ 반응형 UI (데스크톱/모바일)

### 성능 목표
- PDF 로딩: 3초 이내
- 채팅 응답: 5초 이내  
- UI 반응성: 60fps 유지
- 메모리 사용: 500MB 이하

### 사용자 경험 목표
- 직관적 파일 선택 UI
- 끊김 없는 채팅 경험
- 문서-채팅 자연스러운 연동
- 모바일에서도 원활한 사용

---

## 🚨 알려진 기술적 도전과제

### 1. Google Drive API 복잡성
- **OAuth 플로우**: 복잡한 인증 과정
- **파일 권한**: 사용자별 접근 권한 관리
- **API 할당량**: 요청 제한 및 에러 처리

### 2. PDF 렌더링 성능
- **대용량 파일**: 메모리 사용량 최적화
- **모바일 성능**: 터치 스크롤 및 줌 최적화
- **다양한 PDF 형식**: 호환성 이슈

### 3. 컨텍스트 품질
- **페이지 인식**: 현재 보고 있는 페이지 정확히 추적
- **텍스트 선택**: 정확한 텍스트 추출 및 전달
- **의미있는 컨텍스트**: Gemini에게 효과적인 프롬프트 생성

---

## 💡 권장 구현 전략

### Phase 1 우선순위 (1주차)
1. **Google Drive API 기본 연동**
2. **OAuth 인증 플로우 구현**
3. **파일 목록 UI 기본 구현**
4. **PDF 뷰어 기본 통합**

### Phase 2 우선순위 (2주차)  
1. **채팅-문서 컨텍스트 연동**
2. **페이지 추적 시스템**
3. **텍스트 선택 기능**
4. **반응형 UI 완성**

### Phase 3 우선순위 (3주차)
1. **성능 최적화**
2. **에러 처리 강화**
3. **사용자 경험 개선**
4. **배포 준비**

---

*이 문서는 Claude Code가 작성한 프로젝트 인수인계서입니다.*
*Gemini CLI의 성공적인 구현을 위한 완전한 가이드를 제공합니다.*